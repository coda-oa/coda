{% extends "base.html" %}
{% block content %}
    <h1 class="my-2">
        <span class="mr-1">Funding Request</span>
        <small>
            {% if funding_request.is_open %}
                <span class="pill fundingrequest__status-label fundingrequest__open">Open</span>
            {% elif funding_request.is_approved %}
                <span class="pill fundingrequest__status-label fundingrequest__approved">Approved</span>
            {% elif funding_request.is_rejected %}
                <span class="pill fundingrequest__status-label fundingrequest__rejected">Rejected</span>
            {% endif %}
        </small>
    </h1>
    <div class="flex wrap justify-between my-2">
        <div class="flex align-center wrap">
            <span class="mr-2">Labels:</span>
            {% for label in funding_request.labels.all %}
                {% include "fundingrequests/forms/label.html" %}
            {% endfor %}
        </div>
        <div class="flex">{% include "fundingrequests/forms/label_attach.html" %}</div>
    </div>
    <div>
        <table>
            <tbody>
                <tr>
                    <td>Request ID</td>
                    <td>{{ funding_request.request_id }}</td>
                </tr>
                <tr>
                    <td>Request Submitter</td>
                    <td>
                        <p>{{ funding_request.submitter.name }}</p>
                        <p>{{ funding_request.submitter.affiliation.name }}</p>
                        <p>
                            {% for role in funding_request.submitter.get_roles %}<span>{{ role.value }}</span>{% endfor %}
                        </p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h2>Publication Details</h2>
        <table>
            <tbody>
                <tr>
                    <td>Title</td>
                    <td>{{ funding_request.publication.title }}</td>
                </tr>
                <tr>
                    <td>Journal</td>
                    <td>{{ funding_request.publication.journal.title }}</td>
                </tr>
                <tr>
                    <td>Estimated Cost</td>
                    <td>{{ funding_request.estimated_cost }} {{ funding_request.estimated_cost_currency }}</td>
                </tr>
            </tbody>
        </table>
        {% if funding_request.publication.links %}
            <h3>References</h3>
            <table>
                <thead>
                    <tr>
                        <th>Link Type</th>
                        <th>Link</th>
                    </tr>
                </thead>
                <tbody>
                    {% for link in funding_request.publication.links.all %}
                        <tr>
                            <td>{{ link.type }}</td>
                            <td>
                                <a href="{{ link.value }}">{{ link.value }}</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}
    </div>
    <div class="flex my-2">
        {% if funding_request.is_open %}
            <form method="post" action="{% url "fundingrequests:approve" %}">
                {% csrf_token %}
                <input type="hidden" name="fundingrequest" value="{{ funding_request.id }}">
                <button type="submit"
                        class="fundingrequest__status-label fundingrequest__approved">Approve</button>
            </form>
            <form method="post" action="{% url "fundingrequests:reject" %}">
                {% csrf_token %}
                <input type="hidden" name="fundingrequest" value="{{ funding_request.id }}">
                <button type="submit"
                        class="fundingrequest__status-label fundingrequest__rejected">Reject</button>
            </form>
        {% else %}
            <form method="post" action="{% url "fundingrequests:open" %}">
                {% csrf_token %}
                <input type="hidden" name="fundingrequest" value="{{ funding_request.id }}">
                <button type="submit">Re-open</button>
            </form>
        {% endif %}
    </div>
{% endblock content %}
